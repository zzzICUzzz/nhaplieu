<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mẫu Thu Thập Số Liệu Nghiên Cứu</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 20px;
            background-color: #f4f4f9;
            max-width: 800px;
            margin: 0 auto;
        }
        form {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
        }
        label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        .section-title {
            margin-top: 20px;
            font-size: 1.2em;
            color: #333;
            text-transform: uppercase;
            font-weight: bold;
        }
        .sub-section {
            margin-left: 20px;
            margin-top: 10px;
        }
        button {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #218838;
        }
        .checkbox-group, .radio-group {
            display: flex;
            flex-direction: column;
        }
        .checkbox-group label, .radio-group label {
            font-weight: normal;
            margin-top: 5px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        tr.checked-row {
            background-color: #d4edda; /* Màu nền xanh nhạt khi được tick */
        }
        td input[type="checkbox"] {
            transform: scale(1.5); /* Tăng kích thước checkbox */
        }
    </style>
</head>
<body>

    <h1>Mẫu Thu Thập Số Liệu Nghiên Cứu</h1>
    <form id="researchForm" action="" method="post" >
        <!-- Thông Tin Chung -->
        <label for="ma-so-nghien-cuu">1. Mã số nghiên cứu:</label>
        <input type="text" id="1-ma-so-nghien-cuu" name="1-ma-so-nghien-cuu">

        <label for="ma-ho-so">2. Mã hồ sơ/bệnh án:</label>
        <input type="text" id="2-ma-ho-so" name="2-ma-ho-so">

        <label for="ho-ten">3. Họ tên người tham gia nghiên cứu:</label>
        <input type="text" id="3-ho-ten" name="3-ho-ten">

        <label for="dia-chi">4. Địa chỉ hiện tại:</label>
        <input type="text" id="4-dia-chi" name="4-dia-chi">

        <label for="so-dien-thoai">5. Số điện thoại:</label>
        <input type="text" id="5-so-dien-thoai" name="5-so-dien-thoai">

        <label for="ngay-phong-van">6. Ngày phỏng vấn:</label>
        <input type="date" id="6-ngay-phong-van" name="6-ngay-phong-van">

        <!-- Đặc Điểm Chung -->
        <div class="section-title">I. ĐẶC ĐIỂM CHUNG CỦA ĐỐI TƯỢNG NGHIÊN CỨU</div>

        <label for="gioi-tinh">7. Giới tính:</label>
        <select id="7-gioi-tinh" name="7-gioi-tinh">
            <option value="1">Nam</option>
            <option value="2">Nữ</option>
        </select>

        <label for="nam-sinh">8. Năm sinh:</label>
        <input type="number" id="8-nam-sinh" name="8-nam-sinh" min="1900" max="2100">

        <label for="noi-song">9. Nơi sống:</label>
        <select id="9-noi-song" name="9-noi-song">
            <option value="1">Thành thị</option>
            <option value="2">Nông thôn</option>
        </select>

        <label for="tinh-trang-sinh-song">10. Tình trạng sinh sống:</label>
        <select id="10-tinh-trang-sinh-song" name="10-tinh-trang-sinh-song">
            <option value="1">Cùng người thân</option>
            <option value="2">Một mình</option>
            <option value="3">Viện dưỡng lão</option>
        </select>

        <label for="tinh-trang-kinh-te">11. Tình trạng kinh tế:</label>
        <select id="11-tinh-trang-kinh-te" name="11-tinh-trang-kinh-te">
            <option value="1">Hộ nghèo/cận nghèo</option>
            <option value="2">Không nghèo</option>
        </select>

        <label for="trinh-do-hoc-van">12. Trình độ học vấn:</label>
        <select id="12-trinh-do-hoc-van" name="12-trinh-do-hoc-van">
            <option value="0">Mù chữ</option>
            <option value="1">Cấp 1</option>
            <option value="2">Cấp 2</option>
            <option value="3">Cấp 3</option>
            <option value="4">Trên cấp 3</option>
        </select>

        <label for="nghe-nghiep">13. Nghề nghiệp:</label>
        <select id="13-nghe-nghiep" name="13-nghe-nghiep">
            <option value="1">Viên chức</option>
            <option value="2">Công nhân</option>
            <option value="3">Nông dân</option>
            <option value="4">Nội trợ</option>
            <option value="5">Buôn bán</option>
            <option value="6">Lao động tay chân</option>
            <option value="7">Khác</option>
        </select>
        <input type="text" id="13-nghe-nghiep-khac" name="13-nghe-nghiep-khac" placeholder="Nếu chọn 'Khác', vui lòng ghi rõ">

        <label for="can-nang">14.1. Cân nặng (kg):</label>
        <input type="number" id="14-1-can-nang" name="14-1-can-nang" step="0.1" min="0">

        <label for="chieu-cao">14.2. Chiều cao (m):</label>
        <input type="number" id="14-2-chieu-cao" name="14-2-chieu-cao" step="0.01" min="0">

        <label for="bmi">14.3. BMI (kg/m²):</label>
        <input type="number" id="14-3-bmi" name="14-3-bmi" step="0.1" min="0">

        <!-- II. Tiền Căn -->
<div class="section-title">II. TIỀN CĂN</div>

<label>15. Hút thuốc lá:</label>
<div class="radio-group">
    <label>
        Có
        <input type="radio" name="15-hut-thuoc-la" value="1">
        <span class="checkmark"></span>
    </label>
    <label>
        Không
        <input type="radio" name="15-hut-thuoc-la" value="2">
        <span class="checkmark"></span>
    </label>
    <label>
        Chưa từng hút
        <input type="radio" name="15-hut-thuoc-la" value="3">
        <span class="checkmark"></span>
    </label>
    <label>
        Đã hút nhưng ngưng cách đây: 
        <input type="radio" name="15-hut-thuoc-la" value="4">
        <span class="checkmark"></span> 
        <input type="number" name="15-hut-thuoc-la-ngung" min="0" placeholder="Số năm">
    </label>
    <label>
        Đang hút - Số gói – năm: 
        <input type="radio" name="15-hut-thuoc-la" value="5">
        <span class="checkmark"></span>
        <input type="number" name="15-hut-thuoc-la-so-goi-nam" min="0" placeholder="Số gói">
    </label>
</div>

<label>16. Uống rượu bia:</label>
<div class="radio-group">
    <label>
        Có
        <input type="radio" name="16-uong-ruou-bia" value="1">
        <span class="checkmark"></span>
    </label>
    <label>
        Không
        <input type="radio" name="16-uong-ruou-bia" value="2">
        <span class="checkmark"></span>
    </label>
</div>

<label>17. Tiền sử té ngã trong vòng 12 tháng gần đây:</label>
<div class="radio-group">
    <label>
        Có
        <input type="radio" name="17-tien-su-te-nga" value="1">
        <span class="checkmark"></span>
    </label>
    <label>
        Không
        <input type="radio" name="17-tien-su-te-nga" value="2">
        <span class="checkmark"></span>
    </label>
</div>

<label>18. Tiền sử gãy xương bản thân trong 5 năm:</label>
<div class="radio-group">
    <label>
        Có
        <input type="radio" name="18-tien-su-gay-xuong-ban-than" value="1">
        <span class="checkmark"></span>
    </label>
    <label>
        Không
        <input type="radio" name="18-tien-su-gay-xuong-ban-than" value="2">
        <span class="checkmark"></span>
    </label>
</div>

<label>19. Tiền sử người thân trực hệ gãy xương:</label>
<div class="radio-group">
    <label>
        Có
        <input type="radio" name="19-tien-su-nguoi-than-truc-he" value="1">
        <span class="checkmark"></span>
    </label>
    <label>
        Không
        <input type="radio" name="19-tien-su-nguoi-than-truc-he" value="2">
        <span class="checkmark"></span>
    </label>
</div>

<label>20. Tiền sử sử dụng corticoid:</label>
<div class="radio-group">
    <label>
        Có
        <input type="radio" name="20-tien-su-su-dung-corticoid" value="1">
        <span class="checkmark"></span>
    </label>
    <label>
        Không
        <input type="radio" name="20-tien-su-su-dung-corticoid" value="2">
        <span class="checkmark"></span>
    </label>
</div>
<div class="session-title"  >21. chỉ số đa bệnh lý Charlson</div>
<table>
    <tr>
        <th>Bệnh phối hợp CCI</th>
        <th>Điểm</th>
        <th>Có (Đánh dấu X)</th>
    </tr>
    <tr>
        <td>Nhồi máu cơ tim</td>
        <td>1</td>
        <td><input type="checkbox" class="score-checkbox" data-score="1"></td>
    </tr>
    <tr>
        <td>Suy tim</td>
        <td>1</td>
        <td><input type="checkbox" class="score-checkbox" data-score="1"></td>
    </tr>
    <tr>
        <td>Bệnh mạch máu ngoại vi</td>
        <td>1</td>
        <td><input type="checkbox" class="score-checkbox" data-score="1"></td>
    </tr>
    <tr>
        <td>Bệnh mạch máu não</td>
        <td>1</td>
        <td><input type="checkbox" class="score-checkbox" data-score="1"></td>
    </tr>
    <tr>
        <td>sa sút trí tuệ</td>
        <td>1</td>
        <td><input type="checkbox" class="score-checkbox" data-score="1"></td>
    </tr>
    <tr>
        <td>Bệnh phổi mãn tính</td>
        <td>1</td>
        <td><input type="checkbox" class="score-checkbox" data-score="1"></td>
    </tr>
    <tr>
        <td>Bệnh lý mô liên kết</td>
        <td>1</td>
        <td><input type="checkbox" class="score-checkbox" data-score="1"></td>
    </tr>
    <tr>
        <td>Bệnh viêm loét dạ dày tá tràng</td>
        <td>1</td>
        <td><input type="checkbox" class="score-checkbox" data-score="1"></td>
    </tr>
    <tr>
        <td>Bệnh gan nhẹ</td>
        <td>1</td>
        <td><input type="checkbox" class="score-checkbox" data-score="1"></td>
    </tr>
    <tr>
        <td>Bệnh đái tháo đường</td>
        <td>1</td>
        <td><input type="checkbox" class="score-checkbox" data-score="1"></td>
    </tr>
    <tr>
        <td>liệt nửa người</td>
        <td>2</td>
        <td><input type="checkbox" class="score-checkbox" data-score="2"></td>
    </tr>
    <tr>
        <td>Bệnh thận mức độ vừa đến nặng</td>
        <td>2</td>
        <td><input type="checkbox" class="score-checkbox" data-score="2"></td>
    </tr>
    <tr>
        <td>Đái tháo đường có tổn thương cơ quan đích</td>
        <td>2</td>
        <td><input type="checkbox" class="score-checkbox" data-score="2"></td>
    </tr>
    <tr>
        <td>bất kì loại ung thư nào</td>
        <td>2</td>
        <td><input type="checkbox" class="score-checkbox" data-score="2"></td>
    </tr>
    <tr>
        <td>Leukemia</td>
        <td>2</td>
        <td><input type="checkbox" class="score-checkbox" data-score="2"></td>
    </tr>
    <tr>
        <td>U lympho</td>
        <td>2</td>
        <td><input type="checkbox" class="score-checkbox" data-score="2"></td>
    </tr>
    <tr>
        <td>Bệnh gan mức độ vừa đến nặng</td>
        <td>3</td>
        <td><input type="checkbox" class="score-checkbox" data-score="3"></td>
    </tr>
    <tr>
        <td>Ung thư tạng đặc di căn</td>
        <td>4</td>
        <td><input type="checkbox" class="score-checkbox" data-score="4"></td>
    </tr>
    <tr>
        <td>AIDS</td>
        <td>4</td>
        <td><input type="checkbox" class="score-checkbox" data-score="4"></td>
    </tr>
    <tr>
        <th colspan="2">Tổng điểm</th>
        <th><input type="text" id="total-score-charlson" readonly></th>
    </tr>
</table>
<h2>III. ĐÁNH GIÁ THIẾU CƠ – LOÃNG XƯƠNG:</h2>

<h3>23. Mật độ xương:</h3>
<table>
    <thead>
        <tr>
            <th>Vị trí</th>
            <th>MDX</th>
            <th>T-score</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>L1</td>
            <td><input type="text" name="mdx-l1"></td>
            <td><input type="text" name="t-score-l1"></td>
        </tr>
        <tr>
            <td>L2</td>
            <td><input type="text" name="mdx-l2"></td>
            <td><input type="text" name="t-score-l2"></td>
        </tr>
        <tr>
            <td>L3</td>
            <td><input type="text" name="mdx-l3"></td>
            <td><input type="text" name="t-score-l3"></td>
        </tr>
        <tr>
            <td>L4</td>
            <td><input type="text" name="mdx-l4"></td>
            <td><input type="text" name="t-score-l4"></td>
        </tr>
        <tr>
            <td>L1 – L4</td>
            <td><input type="text" name="mdx-l1-l4"></td>
            <td><input type="text" name="t-score-l1-l4"></td>
        </tr>
        <tr>
            <td>Xương vùng hông - Total</td>
            <td><input type="text" name="mdx-total"></td>
            <td><input type="text" name="t-score-total"></td>
        </tr>
        <tr>
            <td>Xương vùng hông - Neck</td>
            <td><input type="text" name="mdx-neck"></td>
            <td><input type="text" name="t-score-neck"></td>
        </tr>
    </tbody>
</table>

<h3>24. Khối lượng cơ xương (ASM) bằng phương pháp DXA: <input type="text" name="24-khoi-luong-co-xuong" style="display: inline; width: 20%; margin-left: 10px;"></h3>

<h3>25. Chỉ số cơ xương SMI = ASM/chiều cao²: 
    <input type="text" name="25-smi" style="display: inline; width: 20%; margin-left: 10px;">
</h3>

<h3>26. Lực bóp tay trái: 
    Lần 1: <input type="text" name="26-luc-bop-trai-lan-1" style="display: inline; width: 15%; margin-left: 10px;">
    Lần 2: <input type="text" name="26-luc-bop-trai-lan-2" style="display: inline; width: 15%; margin-left: 10px;">
    <label style="display: inline; margin-left: 10px;"><input type="checkbox" name="tay-thuan-trai"> Tay thuận</label>
</h3>

<h3>27. Lực bóp tay phải: 
    Lần 1: <input type="text" name="27-luc-bop-phai-lan-1" style="display: inline; width: 15%; margin-left: 10px;">
    Lần 2: <input type="text" name="27-luc-bop-phai-lan-2" style="display: inline; width: 15%; margin-left: 10px;">
    <label style="display: inline; margin-left: 10px;"><input type="checkbox" name="tay-thuan-phai"> Tay thuận</label>
</h3>


<h3>Giá trị cao nhất: <input type="text" name="gia-tri-cao-nhat" style="display: inline; width: 50%;"></h3>

<h3>28. Thời gian đi bộ 6m (giây): <input type="text" name="28-thoi-gian-di-bo-6m" style="display: inline; width: 20%;"> giây</h3>

<h2>IV. Cận lâm sàng</h2>

<table>
    <thead>
        <tr>
            <th>Xét nghiệm</th>
            <th>Kết quả</th>
            <th>Xét nghiệm</th>
            <th>Kết quả</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Osteocalcin</td>
            <td><input type="text" name="osteocalcin"></td>
            <td>Urea</td>
            <td><input type="text" name="urea"></td>
        </tr>
        <tr>
            <td>Beta CTX</td>
            <td><input type="text" name="betactx"></td>
            <td>Creatinin</td>
            <td><input type="text" name="creatinin"></td>
        </tr>
        <tr>
            <td>Hb</td>
            <td><input type="text" name="hb"></td>
            <td>Calci toàn phần</td>
            <td><input type="text" name="calcitotal"></td>
        </tr>
        <tr>
            <td>Số lượng hồng cầu</td>
            <td><input type="text" name="slhongcau"></td>
            <td>AST</td>
            <td><input type="text" name="ast"></td>
        </tr>
        <tr>
            <td>Số lương bạch cầu</td>
            <td><input type="text" name="slbachcau"></td>
            <td>ALT</td>
            <td><input type="text" name="ALT"></td>
        </tr>
        <tr>
            <td>số lượng tiểu cầu</td>
            <td><input type="number" name="sltieucau"></td>
        </tr>
    </tbody>
</table>

        
        <button type="submit">Gửi</button>
    </form>

    <script>
        document.getElementById('researchForm').addEventListener('submit', async function(e) {
            e.preventDefault(); // Ngăn không cho form gửi đi theo cách thông thường
        
            // Lấy thời gian hiện tại và dữ liệu từ biểu mẫu
            const currentTime = new Date().toLocaleString('vi-VN', { timeZone: 'Asia/Ho_Chi_Minh' });
            const formData = new FormData(this);
            
            // Thêm thời gian vào formData
            formData.append('time', currentTime);
            
            // Xử lý tất cả các trường checkbox
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach((checkbox) => {
                if (checkbox.checked) {
                    formData.append(checkbox.name, checkbox.value || checkbox.getAttribute('data-score'));
                } else {
                    formData.append(checkbox.name, "0");  // Nếu không chọn, gán giá trị mặc định
                }
            });
        
            // Xử lý các radio button để đảm bảo chúng có giá trị
            const radios = document.querySelectorAll('input[type="radio"]');
            radios.forEach((radio) => {
                if (radio.checked) {
                    formData.append(radio.name, radio.value);
                } else if (!formData.has(radio.name)) {
                    formData.append(radio.name, "N/A");  // Gán giá trị mặc định nếu radio không được chọn
                }
            });
        
            // Chuyển formData thành đối tượng JSON
            const data = {};
            formData.forEach((value, key) => {
                if (value === "") {
                    data[key] = "N/A"; // Gán giá trị mặc định nếu trường trống
                } else {
                    data[key] = value;
                }
            });
            
            // In dữ liệu JSON ra console trước khi gửi
            console.log("Dữ liệu JSON sẽ gửi:", JSON.stringify(data));
            try {
                // Gửi dữ liệu đến Google Sheets với mode: 'no-cors'
                await fetch('https://script.google.com/macros/s/AKfycbyS1-3lkA3hZKrNvG76o836px3N0jIkkTM4QwVM2tPM7R0CXigko-XT7rT8q5C1yE2zqg/exec', {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });            
                
                console.log("Dữ liệu đã được gửi thành công tới Google Sheets!");
                alert("Dữ liệu đã được lưu lại thành công!");
            } catch (error) {
                console.error("Lỗi khi gửi dữ liệu tới Google Sheets:", error);
                alert("Lỗi khi gửi mẫu. Vui lòng thử lại.");
            }
        });
    </script>

</body>
</html>
