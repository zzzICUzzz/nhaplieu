<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mẫu Thu Thập Số Liệu Nghiên Cứu</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 20px;
            background-color: #f4f4f9;
            max-width: 800px;
            margin: 0 auto;
        }
        form {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
        }
        label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        .section-title {
            margin-top: 20px;
            font-size: 1.2em;
            color: #333;
            text-transform: uppercase;
            font-weight: bold;
        }
        .sub-section {
            margin-left: 20px;
            margin-top: 10px;
        }
        button {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #218838;
        }
        .checkbox-group, .radio-group {
            display: flex;
            flex-direction: column;
        }
        .checkbox-group label, .radio-group label {
            font-weight: normal;
            margin-top: 5px;
        }
        .radio-group label {
            display: block;
            position: relative;
            padding-left: 35px;
            margin-bottom: 12px;
            cursor: pointer;
            font-size: 18px;
            user-select: none;
        }
    
        .radio-group input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }
    
        /* Thiết kế hình dạng ô chọn (radio button) */
        .radio-group .checkmark {
            position: absolute;
            top: 0;
            left: 0;
            height: 25px;
            width: 25px;
            background-color: #eee;
            border-radius: 50%;
            border: 2px solid #ccc;
        }
    
        /* Tô màu khi radio được chọn */
        .radio-group input:checked ~ .checkmark {
            background-color: #28a745;
            border-color: #28a745;
        }
    
        /* Đánh dấu khi được chọn */
        .radio-group .checkmark:after {
            content: "";
            position: absolute;
            display: none;
        }
    
        .radio-group input:checked ~ .checkmark:after {
            display: block;
        }
    
        /* Thiết kế đánh dấu chọn */
        .radio-group .checkmark:after {
            top: 7px;
            left: 7px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: white;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        tr.checked-row {
            background-color: #d4edda; /* Màu nền xanh nhạt khi được tick */
        }
        td input[type="checkbox"] {
            transform: scale(1.5); /* Tăng kích thước checkbox */
        }
    </style>
</head>
<body>

    <h1>Mẫu Thu Thập Số Liệu Nghiên Cứu</h1>
    <form id="researchForm" action="" method="post" >
        <!-- Thông Tin Chung -->
        <label for="1.ma-so-nghien-cuu">1. Mã số nghiên cứu:</label>
        <input type="text" id="1.ma-so-nghien-cuu" name="ma-so-nghien-cuu">

        <label for="2.ma-ho-so">2. Mã hồ sơ/bệnh án:</label>
        <input type="text" id="2.ma-ho-so" name="ma-ho-so">

        <label for="3.ho-ten">3. Họ tên người tham gia nghiên cứu:</label>
        <input type="text" id="3.ho-ten" name="ho-ten">

        <label for="4.dia-chi">4. Địa chỉ hiện tại:</label>
        <input type="text" id="4.dia-chi" name="dia-chi">

        <label for="5.so-dien-thoai">5. Số điện thoại:</label>
        <input type="text" id="5.so-dien-thoai" name="so-dien-thoai">

        <label for="6.ngay-phong-van">6. Ngày phỏng vấn:</label>
        <input type="date" id="6.ngay-phong-van" name="ngay-phong-van">

        <!-- Đặc Điểm Chung -->
        <div class="section-title">I. ĐẶC ĐIỂM CHUNG CỦA ĐỐI TƯỢNG NGHIÊN CỨU</div>

        <label for="7.gioi-tinh">7. Giới tính:</label>
        <select id="7.gioi-tinh" name="7.gioi-tinh">
            <option value="1">Nam</option>
            <option value="2">Nữ</option>
        </select>

        <label for="8.nam-sinh">8. Năm sinh:</label>
        <input type="number" id="8.nam-sinh" name="nam-sinh" min="1900" max="2100">

        <label for="9.noi-song">9. Nơi sống:</label>
        <select id="9.noi-song" name="9.noi-song">
            <option value="1">Thành thị</option>
            <option value="2">Nông thôn</option>
        </select>

        <label for="10.tinh-trang-sinh-song">10. Tình trạng sinh sống:</label>
        <select id="10.tinh-trang-sinh-song" name="10.tinh-trang-sinh-song">
            <option value="1">Cùng người thân</option>
            <option value="2">Một mình</option>
            <option value="3">Viện dưỡng lão</option>
        </select>

        <label for="11.tinh-trang-kinh-te">11. Tình trạng kinh tế:</label>
        <select id="11.tinh-trang-kinh-te" name="11.tinh-trang-kinh-te">
            <option value="1">Hộ nghèo/cận nghèo</option>
            <option value="2">Không nghèo</option>
        </select>

        <label for="12.trinh-do-hoc-van">12. Trình độ học vấn:</label>
        <select id="12.trinh-do-hoc-van" name="12.trinh-do-hoc-van">
            <option value="0">Mù chữ</option>
            <option value="1">Cấp 1</option>
            <option value="2">Cấp 2</option>
            <option value="3">Cấp 3</option>
            <option value="4">Trên cấp 3</option>
        </select>

        <label for="13.nghe-nghiep">13. Nghề nghiệp:</label>
        <select id="13.nghe-nghiep" name="13.nghe-nghiep">
            <option value="1">Viên chức</option>
            <option value="2">Công nhân</option>
            <option value="3">Nông dân</option>
            <option value="4">Nội trợ</option>
            <option value="5">Buôn bán</option>
            <option value="6">Lao động tay chân</option>
            <option value="7">Khác</option>
        </select>
        <input type="text" id="nghe-nghiep-khac" name="nghe-nghiep-khac" placeholder="Nếu chọn 'Khác', vui lòng ghi rõ">

        <label for="14.1.can-nang">14.1. Cân nặng (kg):</label>
        <input type="number" id="14.1.can-nang" name="14.1.can-nang" step="0.1" min="0">

        <label for="14.2.chieu-cao">14.2. Chiều cao (m):</label>
        <input type="number" id="14.2.chieu-cao" name="14.2.chieu-cao" step="0.01" min="0">

        <label for="14.3.bmi">14.3. BMI (kg/m²):</label>
        <input type="number" id="14.3.bmi" name="14.3.bmi" step="0.1" min="0">

        <!-- II. Tiền Căn -->
<div class="section-title">II. TIỀN CĂN</div>

<label>15. Hút thuốc lá:</label>
<div class="radio-group">
    <label>
        Có
        <input type="radio" name="15.hut-thuoc-la" value="1">
        <span class="checkmark"></span>
    </label>
    <label>
        Không
        <input type="radio" name="15.hut-thuoc-la" value="2">
        <span class="checkmark"></span>
    </label>
    <label>
        Chưa từng hút
        <input type="radio" name="15.hut-thuoc-la" value="3">
        <span class="checkmark"></span>
    </label>
    <label>
        Đã hút nhưng ngưng cách đây: 
        <input type="radio" name="15.hut-thuoc-la" value="4">
        <span class="checkmark"></span> 
        <input type="number" name="15.hut-thuoc-la-ngung" min="0" placeholder="Số năm">
    </label>
    <label>
        Đang hút - Số gói – năm: 
        <input type="radio" name="15.hut-thuoc-la" value="5">
        <span class="checkmark"></span>
        <input type="number" name="15.hut-thuoc-la-so-goi-nam" min="0" placeholder="Số gói">
    </label>
</div>

<label>16. Uống rượu bia:</label>
<div class="radio-group">
    <label>
        Có
        <input type="radio" name="16.uong-ruou-bia" value="1">
        <span class="checkmark"></span>
    </label>
    <label>
        Không
        <input type="radio" name="16.uong-ruou-bia" value="2">
        <span class="checkmark"></span>
    </label>
</div>

<label>17. Tiền sử té ngã trong vòng 12 tháng gần đây:</label>
<div class="radio-group">
    <label>
        Có
        <input type="radio" name="17.tien-su-te-nga" value="1">
        <span class="checkmark"></span>
    </label>
    <label>
        Không
        <input type="radio" name="17.tien-su-te-nga" value="2">
        <span class="checkmark"></span>
    </label>
</div>

<label>18. Tiền sử gãy xương bản thân trong 5 năm:</label>
<div class="radio-group">
    <label>
        Có
        <input type="radio" name="18.tien-su-gay-xuong-ban-than" value="1">
        <span class="checkmark"></span>
    </label>
    <label>
        Không
        <input type="radio" name="18.tien-su-gay-xuong-ban-than" value="2">
        <span class="checkmark"></span>
    </label>
</div>

<label>19. Tiền sử người thân trực hệ gãy xương:</label>
<div class="radio-group">
    <label>
        Có
        <input type="radio" name="19.tien-su-nguoi-than-truc-he" value="1">
        <span class="checkmark"></span>
    </label>
    <label>
        Không
        <input type="radio" name="19.tien-su-nguoi-than-truc-he" value="2">
        <span class="checkmark"></span>
    </label>
</div>

<label>20. Tiền sử sử dụng corticoid:</label>
<div class="radio-group">
    <label>
        Có
        <input type="radio" name="20.tien-su-su-dung-corticoid" value="1">
        <span class="checkmark"></span>
    </label>
    <label>
        Không
        <input type="radio" name="20.tien-su-su-dung-corticoid" value="2">
        <span class="checkmark"></span>
    </label>
</div>
<div class="session-title"  >21. chỉ số đa bệnh lý Charlson</div>
<table>
    <tr>
        <th>Bệnh phối hợp CCI</th>
        <th>Điểm</th>
        <th>Có (Đánh dấu X)</th>
    </tr>
    <tr>
        <td>Nhồi máu cơ tim</td>
        <td>1</td>
        <td><input type="checkbox" class="score-checkbox" data-score="1"></td>
    </tr>
    <tr>
        <td>Suy tim</td>
        <td>1</td>
        <td><input type="checkbox" class="score-checkbox" data-score="1"></td>
    </tr>
    <tr>
        <td>Bệnh mạch máu ngoại vi</td>
        <td>1</td>
        <td><input type="checkbox" class="score-checkbox" data-score="1"></td>
    </tr>
    <tr>
        <td>Bệnh mạch máu não</td>
        <td>1</td>
        <td><input type="checkbox" class="score-checkbox" data-score="1"></td>
    </tr>
    <tr>
        <td>sa sút trí tuệ</td>
        <td>1</td>
        <td><input type="checkbox" class="score-checkbox" data-score="1"></td>
    </tr>
    <tr>
        <td>Bệnh phổi mãn tính</td>
        <td>1</td>
        <td><input type="checkbox" class="score-checkbox" data-score="1"></td>
    </tr>
    <tr>
        <td>Bệnh lý mô liên kết</td>
        <td>1</td>
        <td><input type="checkbox" class="score-checkbox" data-score="1"></td>
    </tr>
    <tr>
        <td>Bệnh viêm loét dạ dày tá tràng</td>
        <td>1</td>
        <td><input type="checkbox" class="score-checkbox" data-score="1"></td>
    </tr>
    <tr>
        <td>Bệnh gan nhẹ</td>
        <td>1</td>
        <td><input type="checkbox" class="score-checkbox" data-score="1"></td>
    </tr>
    <tr>
        <td>Bệnh đái tháo đường</td>
        <td>1</td>
        <td><input type="checkbox" class="score-checkbox" data-score="1"></td>
    </tr>
    <tr>
        <td>liệt nửa người</td>
        <td>2</td>
        <td><input type="checkbox" class="score-checkbox" data-score="2"></td>
    </tr>
    <tr>
        <td>Bệnh thận mức độ vừa đến nặng</td>
        <td>2</td>
        <td><input type="checkbox" class="score-checkbox" data-score="2"></td>
    </tr>
    <tr>
        <td>Đái tháo đường có tổn thương cơ quan đích</td>
        <td>2</td>
        <td><input type="checkbox" class="score-checkbox" data-score="2"></td>
    </tr>
    <tr>
        <td>bất kì loại ung thư nào</td>
        <td>2</td>
        <td><input type="checkbox" class="score-checkbox" data-score="2"></td>
    </tr>
    <tr>
        <td>Leukemia</td>
        <td>2</td>
        <td><input type="checkbox" class="score-checkbox" data-score="2"></td>
    </tr>
    <tr>
        <td>U lympho</td>
        <td>2</td>
        <td><input type="checkbox" class="score-checkbox" data-score="2"></td>
    </tr>
    <tr>
        <td>Bệnh gan mức độ vừa đến nặng</td>
        <td>3</td>
        <td><input type="checkbox" class="score-checkbox" data-score="3"></td>
    </tr>
    <tr>
        <td>Ung thư tạng đặc di căn</td>
        <td>4</td>
        <td><input type="checkbox" class="score-checkbox" data-score="4"></td>
    </tr>
    <tr>
        <td>AIDS</td>
        <td>4</td>
        <td><input type="checkbox" class="score-checkbox" data-score="4"></td>
    </tr>
    <tr>
        <th colspan="2">Tổng điểm</th>
        <th><input type="text" id="total-score-charlson" readonly></th>
    </tr>
</table>
<h2>III. ĐÁNH GIÁ THIẾU CƠ – LOÃNG XƯƠNG:</h2>

<h3>23. Mật độ xương:</h3>
<table>
    <thead>
        <tr>
            <th>Vị trí</th>
            <th>MDX</th>
            <th>T-score</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>L1</td>
            <td><input type="text" name="mdx_l1"></td>
            <td><input type="text" name="t_score_l1"></td>
        </tr>
        <tr>
            <td>L2</td>
            <td><input type="text" name="mdx_l2"></td>
            <td><input type="text" name="t_score_l2"></td>
        </tr>
        <tr>
            <td>L3</td>
            <td><input type="text" name="mdx_l3"></td>
            <td><input type="text" name="t_score_l3"></td>
        </tr>
        <tr>
            <td>L4</td>
            <td><input type="text" name="mdx_l4"></td>
            <td><input type="text" name="t_score_l4"></td>
        </tr>
        <tr>
            <td>L1 – L4</td>
            <td><input type="text" name="mdx_l1_l4"></td>
            <td><input type="text" name="t_score_l1_l4"></td>
        </tr>
        <tr>
            <td>Xương vùng hông - Total</td>
            <td><input type="text" name="mdx_total"></td>
            <td><input type="text" name="t_score_total"></td>
        </tr>
        <tr>
            <td>Xương vùng hông - Neck</td>
            <td><input type="text" name="mdx_neck"></td>
            <td><input type="text" name="t_score_neck"></td>
        </tr>
    </tbody>
</table>

<h3>24. Khối lượng cơ xương (ASM) bằng phương pháp DXA: <input type="text" name="khoi_luong_co_xuong" style="display: inline; width: 20%; margin-left: 10px;"></h3>

<h3>25. Chỉ số cơ xương SMI = ASM/chiều cao²: 
    <input type="text" name="smi" style="display: inline; width: 20%; margin-left: 10px;">
</h3>

<h3>26. Lực bóp tay trái: 
    Lần 1: <input type="text" name="luc_bop_trai_lan_1" style="display: inline; width: 15%; margin-left: 10px;">
    Lần 2: <input type="text" name="luc_bop_trai_lan_2" style="display: inline; width: 15%; margin-left: 10px;">
    <label style="display: inline; margin-left: 10px;"><input type="checkbox" name="tay_thuan_trai"> Tay thuận</label>
</h3>

<h3>27. Lực bóp tay phải: 
    Lần 1: <input type="text" name="luc_bop_phai_lan_1" style="display: inline; width: 15%; margin-left: 10px;">
    Lần 2: <input type="text" name="luc_bop_phai_lan_2" style="display: inline; width: 15%; margin-left: 10px;">
    <label style="display: inline; margin-left: 10px;"><input type="checkbox" name="tay_thuan_phai"> Tay thuận</label>
</h3>


<h3>Giá trị cao nhất: <input type="text" name="gia_tri_cao_nhat" style="display: inline; width: 50%;"></h3>

<h3>28. Thời gian đi bộ 6m (giây): <input type="text" name="thoi_gian_di_bo_6m" style="display: inline; width: 20%;"> giây</h3>

<h2>IV. Cận lâm sàng</h2>

<table>
    <thead>
        <tr>
            <th>Xét nghiệm</th>
            <th>Kết quả</th>
            <th>Xét nghiệm</th>
            <th>Kết quả</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Osteocalcin</td>
            <td><input type="text" name="osteocalcin"></td>
            <td>Urea</td>
            <td><input type="text" name="urea"></td>
        </tr>
        <tr>
            <td>Beta CTX</td>
            <td><input type="text" name="betactx"></td>
            <td>Creatinin</td>
            <td><input type="text" name="creatinin"></td>
        </tr>
        <tr>
            <td>Hb</td>
            <td><input type="text" name="hb"></td>
            <td>Calci toàn phần</td>
            <td><input type="text" name="calcitotal"></td>
        </tr>
        <tr>
            <td>Số lượng hồng cầu</td>
            <td><input type="text" name="slhongcau"></td>
            <td>AST</td>
            <td><input type="text" name="ast"></td>
        </tr>
        <tr>
            <td>Số lương bạch cầu</td>
            <td><input type="text" name="slbachcau"></td>
            <td>ALT</td>
            <td><input type="text" name="ALT"></td>
        </tr>
        <tr>
            <td>số lượng tiểu cầu</td>
            <td><input type="number" name="sltieucau"></td>
        </tr>
    </tbody>
</table>

        
        <button type="submit">Gửi</button>
    </form>

    <script>
        const checkboxes = document.querySelectorAll('.score-checkbox');
        const totalScoreElement = document.getElementById('total-score-charlson');
    
        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                let totalScore = 0;
    
                checkboxes.forEach(cb => {
                    const row = cb.closest('tr'); // Lấy dòng của checkbox hiện tại
                    if (cb.checked) {
                        totalScore += parseInt(cb.getAttribute('data-score'));
                        row.classList.add('checked-row'); // Thêm lớp để đổi màu
                    } else {
                        row.classList.remove('checked-row'); // Xóa lớp để trở về màu gốc
                    }
                });
    
                totalScoreElement.value = totalScore;
            });
        });

        document.getElementById('researchForm').addEventListener('submit', async function(e) {
            e.preventDefault(); // Ngăn không cho form gửi đi theo cách thông thường

            const currentTime = new Date().toLocaleString('vi-VN', { timeZone: 'Asia/Ho_Chi_Minh' });

            const formData = new FormData(this);
            formData.append('time', currentTime);

            // Thay đổi URL dưới đây thành URL của Google Apps Script của bạn
            const googleSheetsURL = 'https://script.google.com/macros/s/AKfycbxKrkJt3g170gUolJUKqwP7Nv9pvyMXmufMIni5Q9tzpbU-dHAqqPypyzBnXTv5_AEh/exec';

            try {
                const response = await fetch(googleSheetsURL, {
                    method: 'POST',
                    body: formData,
                    mode:'no-cors'
                    
                    });
                    console.log(response);
                    formData.forEach((value, key) => {
                        console.log(key + ": " + value);
                    });
                    
                if (response.ok) {
                    // Hiển thị thông báo thành công và reset form
                    alert('Mẫu của bạn đã được gửi thành công!');
                    location.reload(); // Làm mới lại trang sau khi người dùng nhấn "OK"
                } else {
                    throw new Error('Có lỗi xảy ra khi gửi mẫu');
                }
            } catch (error) {
                console.error("Error submitting result to Google Sheets:", error);
                alert('Có lỗi xảy ra khi gửi mẫu. Vui lòng thử lại.');
            }
        });

    </script>

</body>
</html>
